<% provide(:title,@company.name) %>
<div class="container-fluid">
  <div class="row-fluid">
    <span class="span6">
      <h1 class="heading">
        <%= @company.name %>
        <%= render 'companies/editbutton', object: @company %>
        <%= render 'companies/statuslist', object: @company %>
      </h1> 
      <div>
        <%= link_to "#{@company.url}" ,@company.url %>
      </div>
      <div>
          <p><%= @company.phone%></p>
          <p><%= @company.address %></p>
      </div> 
      <div>
         <p>Point of Contact :<%= link_to @company.pointofcontact.name, @company.pointofcontact %></p>
         <p>Managed by <%= link_to @company.manager.name, @company.manager %>
      </div> 
    </span>
    <span class="span6">
      <% unless @company.contacts.empty? %>
        <h4 class="heading">Contact</h4>
        <p>
          <% if @default %>
            <strong><%= link_to @default.name, show_modal_company_contact_path(:company_id => @company.id,:id => @default.id), {:remote => true, 'data-controls-modal' =>  "contact-modal",'data-toggle'=>'modal', 'data-target'=>'#contact-modal'} %></strong>
            <%= "(#{@default.designation})" %> 
            <span class="badge badge-info pull-right">Default</span>
          <br><tel><%= "(M) #{@default.mobile}, (Off) #{@default.landline}" %>
          <br><a href='mailto:<%=@default.email%>'><%= @default.email %></a></p>
        <% else %>
        <%= "The first default contact appears in full here" %>
        <% end %>
          <h5 class="heading">All contacts <small><%= link_to "Add Contact", new_company_contact_path(:company_id => @company.id),:class => "pull-right" %> </small></h5>
        <% @i=0 %>
        <% @company.contacts.each do |contact| %>
           <% if @default 
                did = @default.id
              else
                did = -1 #Non-existent id
              end
            %>
           <% unless (contact.id == did) || contact.deleted? %>
             <%= link_to contact.name, show_modal_company_contact_path(:company_id => @company.id,:id => contact.id), {:remote => true, 'data-controls-modal' =>  "contact-modal",'data-toggle'=>'modal', 'data-target'=>'#contact-modal'} %>
           <% end %>
        <% end %>
      <% else %>
       <h1> </h1><h1></h1>
        <div class="pagination-centered">
          <%= link_to "Add Contact", new_company_contact_path(:company_id => @company.id),:class => "btn btn-inverse" %> 
        </div>
      <% end %>

      <br/>
      
      
    </span>
    
  </div>
  <hr />
   
      </div>
      <div class="row-fluid">
        
        <div class="span3">
          <h4>Teams with access </h4>
          <%= render 'companies/updateteam', object: @company%>
        </div>
        <span class="span9 ">
          <h4>About the company</h4>
           <%= render 'companies/updatedescription', object: @company%>
        </span>

      </div>
      <hr />
      <div class="row-fluid ">
        
        <span class="span6 pull6">
          <%= render 'companies/newlog' , object: { @company => @company, @newlog => @newlog, @contacts => @contacts } %>
        </span>
      </div>
      <div class="row-fluid">
        <span class="span12">
        <% if @company.logs.any? %>
          <ol class="logs">
            <%= render @logs %>
          </ol>
        <%= will_paginate @logs %>
        <% end %>
        </span>
      </div>   
      
    </div>
<div class="modal hide fade" id="contact-modal">
  <div class="modal-header">
    <a href="#" class="close">Ã—</a>
    <h3>Loading...</h3>
  </div>
  <div class="modal-body center">
      <%= image_tag "loading.gif" %>
  </div>
  <div class="modal-footer">&nbsp;</div>
</div>

